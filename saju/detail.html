<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="사주 상세 분석 - 십성, 합·충·형·파·해, 오행 비율, 대운">
  <meta name="google-adsense-account" content="ca-pub-7043246977521896">
  <title>사주 상세 분석</title>
  <link rel="stylesheet" href="css/style.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7043246977521896" crossorigin="anonymous"></script>
</head>
<body class="destiny-page">
  <div class="destiny-container" id="detail-container">
    <div class="page-top-actions">
      <a href="javascript:history.back()" class="btn-detail">돌아가기</a>
    </div>
    <header class="destiny-header">
      <h1>사주 상세 분석</h1>
      <p>십성·합·충·형·파·해·오행 비율·대운을 확인해 보세요.</p>
    </header>

    <main class="destiny-main">
      <div id="error-area"></div>

      <section class="detail-section">
        <h3><a href="dict.html#saju-palja" class="dict-link">사주팔자</a></h3>
        <div id="saju-table"></div>
      </section>

      <section class="detail-section">
        <h3 class="detail-section-title">
          <a href="dict.html#sipseong" class="dict-link">십성</a>
          <button type="button" class="info-btn" data-info-key="sipseong" aria-label="십성 설명 보기" title="설명">ⓘ</button>
        </h3>
        <p class="section-desc">일간(日干)을 기준으로 한 각 기둥과의 관계입니다.</p>
        <div class="detail-table-wrap"><table class="detail-table" id="sipseong-table"></table></div>
      </section>

      <section class="detail-section">
        <h3 class="detail-section-title">
          <a href="dict.html#hapchung" class="dict-link">합/충/형/파/해</a>
          <button type="button" class="info-btn" data-info-key="hapchunghyeongpahae" aria-label="합/충/형/파/해 설명 보기" title="설명">ⓘ</button>
        </h3>
        <p class="section-desc">지지 간의 조화·상극·형·파·해 관계입니다.</p>
        <div class="detail-table-wrap"><table class="detail-table" id="hapchung-table"></table></div>
      </section>

      <section class="detail-section">
        <h3 class="detail-section-title">
          <a href="dict.html#ohang" class="dict-link">오행 비율</a>
          <button type="button" class="info-btn" data-info-key="ohang" aria-label="오행 비율 설명 보기" title="설명">ⓘ</button>
        </h3>
        <p class="section-desc">사주에 포함된 오행(목·화·토·금·수)의 비율입니다.</p>
        <div id="ohang-chart" class="ohang-chart"></div>
      </section>

      <section class="detail-section">
        <h3 class="detail-section-title">
          <a href="dict.html#daewoon" class="dict-link">대운</a>
          <button type="button" class="info-btn" data-info-key="daewoon" aria-label="대운 설명 보기" title="설명">ⓘ</button>
        </h3>
        <p class="section-desc">10년 단위로 바뀌는 운의 흐름입니다.</p>
        <div class="detail-table-wrap"><table class="detail-table" id="daewoon-table"></table></div>
      </section>
    </main>

    <footer class="destiny-footer">
      <div class="footer-buttons">
        <a href="../index.html" class="btn-footer btn-main">메인으로</a>
        <a href="javascript:history.back()" class="btn-footer btn-retry">돌아가기</a>
      </div>
    </footer>
  </div>

  <script src="js/sajuCalculator.js"></script>
  <script src="js/resultRenderer.js"></script>
  <script src="js/detailRenderer.js"></script>
  <script>
    (function() {
      const params = new URLSearchParams(location.search);
      const birth = params.get('birth');
      const time = params.get('time');
      const min = params.get('min') || '0';
      const gender = params.get('gender') || 'male';
      const calendar = params.get('calendar') || 'solar';

      const errorArea = document.getElementById('error-area');
      const container = document.getElementById('detail-container');

      if (!birth || time === null || time === '') {
        ResultRenderer.renderErrorCard(errorArea, '생년월일과 출생시간이 필요합니다. 입력 페이지로 이동합니다.');
        setTimeout(function() { location.href = 'index.html'; }, 2500);
        return;
      }

      let saju;
      try {
        saju = SajuCalculator.calculate(birth, time, gender, min);
      } catch (e) {
        ResultRenderer.renderErrorCard(errorArea, '잘못된 입력입니다.');
        return;
      }

      DetailRenderer.renderDetail(container, saju);
      DetailRenderer.attachInfoButtons(container);
    })();
  </script>
</body>
</html>
